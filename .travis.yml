language: c++

addons:
  apt:
    sources:
    # add PPAs with more up-to-date toolchains
    - ubuntu-toolchain-r-test
    - llvm-toolchain-precise-3.6
    packages:
    - gfortran
    - g++-5
    - gcc-5
    - clang-3.6

sudo: required
dist: trusty

env:
    global:
        # Set defaults to avoid repeating in most cases
        - CONDA_DEPENDENCIES='scipy matplotlib sympy'
        - PIP_DEPENDENCIES='nose rebound'


matrix:

    # Don't wait for allowed failures
    fast_finish: true

    include:

        # Try with various compilers with default version of numpy/astropy
        # TODO: let's not actually run nosetests for these, but just make
        # sure they build
        - os: linux
          compiler: g++
          env: PYTHON_VERSION=2.7 NUMPY_VERSION=1.10 ASTROPY_VERSION=1.0'
          nosetests: true

        - os: linux
          compiler: g++-5
          env: PYTHON_VERSION=2.7 NUMPY_VERSION=1.10 ASTROPY_VERSION=1.0'
          nosetests: false

        # clang fails to build phoebe1
        # - os: linux
        #   compiler: clang-3.6
        #   env: PYTHON_VERSION=2.7 NUMPY_VERSION=1.10 ASTROPY_VERSION=1.0'

        # - os: osx
        #   compiler: clang-3.6
        #   env: PYTHON_VERSION=2.7 NUMPY_VERSION=1.10 ASTROPY_VERSION=1.0'


        # Try with various version of numpy/astropy with default compiler
        - os: linux
          compiler: g++-5
          env: PYTHON_VERSION=2.7 NUMPY_VERSION=stable ASTROPY_VERSION=stable'
          nosetests: true


    allow_failures:
      - env: NUMPY_VERSION=dev


install:
    - git clone git://github.com/astropy/ci-helpers.git
    - source ci-helpers/travis/setup_conda.sh
    - python setup.py build
    - python setup.py install --user
    - git clone git://github.com/phoebe-project/phoebe1.git
    - cd phoebe1/phoebe-lib
    - ./configure
    - make
    - sudo make install
    - cd ../phoebe-scripter
    - ./configure
    - make
    - sudo make install
    - sudo ldconfig -v
    - cd ../phoebe-py
    - python setup.py build
    - python setup.py install --user
    - cd ../..
    - git clone git://github.com/dfm/photodynam.git
    - cd photodynam
    - make
    - sudo cp photodynam /usr/local/bin/
    - cd ..


script:
    - if [ $nosetests ];
      then cd tests/nosetests && nosetests;
      fi;
